----
# ドキュメント情報
プロジェクト: PintHop
ファイル名: consistency-check-prompt.md
ファイルパス: Prompts/consistency-check-prompt.md
作成者: Koki Riho (https://github.com/Rih0z)
作成日: 2025-04-20
最終更新: 2025-04-21

# 更新履歴
- 2025-04-20 Koki Riho 初版作成
- 2025-04-21 Koki Riho specification.mdをベースドキュメントとして明確化
- 2025-04-21 Koki Riho documents-consistency-analysis.mdの更新指示を追加
- 2025-04-21 Koki Riho 矛盾解決後のドキュメント更新手順を追加
- 2025-04-21 Claude Assistant 標準的なドキュメントヘッダー形式に合わせて更新
- 2025-04-21 Koki Riho ドキュメント更新プロセスを強化（新規ドキュメント作成ではなく既存ドキュメント更新を優先）
- 2025-04-21 Claude Assistant 整合性修正の完了基準を明確化（アーティファクト出力の要件を追加）

# 説明
PintHopプロジェクトの成果物（ドキュメント、ソースコード、設計）が specification.md をベースとして、他の仕様書やソースコード間で矛盾がないか確認し、整合性分析レポートを更新するためのプロンプトです。また、発見された矛盾を解決するために既存ドキュメントを直接更新するプロセスについても説明しています。
----

# PintHop 成果物整合性確認依頼プロンプト

こんにちは！PintHopプロジェクトの成果物整合性確認を行います。あなたが作成または更新した成果物（ドキュメント、ソースコード、UI設計など）が、**specification.md をベースドキュメントとして**、既存のプロジェクト資料と整合性を保っているか確認したいので、以下の情報と共に成果物を送付してください。

## 送付いただきたい情報

1. **成果物の基本情報**:
   - 成果物名（ファイル名）
   - 種類（ドキュメント/ソースコード/データモデル/UI設計など）
   - 目的（この成果物の目的を簡潔に）

2. **関連する既存ドキュメント**:
   - **specification.md** （必須 - ベースドキュメント）
   - その他の関連性が高い既存ドキュメント
   - （例: implementation-plan.md, api-document.md, security-policy.md など）

3. **成果物の内容**: 
   - 作成または更新した成果物の内容全文
   - コードの場合は関連するファイルやコードスニペット

## 提出例

```
成果物名: incident-response.md
種類: ドキュメント
目的: インシデント発生時の対応計画を定義する
関連する既存ドキュメント: 
- specification.md （ベースドキュメント）
- implementation-plan.md
- security-policy.md

--- 成果物内容 ---
# PintHop インシデント対応計画

## 1. 概要

本ドキュメントはPintHopアプリケーションのインシデント対応計画を定義するものです...
（以下、ドキュメント全文）
```

## 整合性確認の観点

成果物の整合性は、**specification.md をベースドキュメントとして**、以下の観点から確認されます：

### 1. ドキュメント形式の整合性
- ドキュメントヘッダー形式
- マークダウン形式の一貫性
- 用語の統一的使用（specification.md で定義された用語に準拠）

### 2. 技術的整合性
- 技術スタックの一貫性（specification.md セクション5の「修正技術スタック」に定義されているReact 18, Node.js 18.x, MongoDB 7.0など）
- APIエンドポイント設計の一貫性
- データモデル定義の一貫性（specification.md セクション4の「修正データモデル」に定義されているモデルとの整合性）
- ファイル構造の一貫性

### 3. ビジネスロジックの整合性
- 核心体験の定義との一貫性（specification.md セクション1の「コンセプト再定義」で定義されている高評価ビール発見、プレゼンス共有）
- 実装フェーズの区分との一貫性（specification.md セクション6の「修正ロードマップ」で定義されているフェーズ0〜5）
- タイムライン記述の一貫性（specification.md セクション9.5の「タイムラインと予算」との整合性）

### 4. セキュリティ要件の整合性
- JWT実装対策の一貫性
- 入力検証とサニタイゼーション方針の一貫性
- APIセキュリティ対策の一貫性
- インシデント対応計画との一貫性

### 5. コーディング規則の整合性
- ファイルヘッダー形式
- 命名規則（PascalCase, camelCase, UPPER_SNAKE_CASEなど）
- コードフォーマット（インデント、行長など）
- コメント規則

### 6. UI/UX設計の整合性
- 5タブ構成との一貫性（specification.md セクション3の「修正ユーザーインターフェース設計」に定義されている構成）
- ナビゲーション構造
- 画面遷移
- デザイン要素の一貫性

## 確認結果の提供と整合性分析レポートの更新

整合性確認の結果として、以下の情報を提供します：

1. **specification.md との整合性**
   - ベースドキュメントとの整合性評価
   - 不一致点の具体的な指摘
   - 整合性を高めるための具体的な提案

2. **その他のドキュメントとの整合性**
   - 検出された整合性の問題（もしあれば）
   - 問題のカテゴリ（形式/技術/ビジネスロジックなど）
   - 問題の詳細な説明
   - 問題が与える可能性のある影響
   - 推奨される対応策

3. **推奨事項**
   - 全体的な改善のための提案
   - 今後の成果物作成において注意すべき点

4. **総合評価**
   - 整合性の全体的な評価
   - 次のステップの提案

## 整合性分析レポートの更新

成果物の確認結果に基づいて、**Document/jp/documents-consistency-analysis.md** を更新してください。このレポートはプロジェクト全体のドキュメント整合性を継続的に監視・記録するためのものです。

更新時には以下の点を含めてください：

1. **新たに検出された矛盾点**:
   - 矛盾の種類と重要度
   - 影響を受けるドキュメント
   - 推奨される解決策

2. **解決済みの矛盾点**:
   - 前回のレポートから解決された矛盾点
   - 解決方法の記録

3. **整合性の傾向分析**:
   - プロジェクト全体の整合性状況の変化
   - 繰り返し発生する問題パターン

4. **最新の更新履歴**:
   - 更新日
   - 主な変更点
   - 次回の推奨確認ポイント

レポートのフォーマットは標準的なドキュメントヘッダーを含め、マークダウン形式で作成してください。既存の整合性分析レポートがある場合は、その構造を維持しながら内容を追加・更新してください。

## 矛盾解決のためのドキュメント更新プロセス

### 重要: 既存ドキュメント更新の厳守

**矛盾点を解決する際は、新しいドキュメントを作成することは避け、必ず既存のドキュメントを直接更新してください。** 新規ドキュメントの作成はドキュメント数を増やし、将来的な整合性維持をより複雑にするため、いかなる状況でも避けるべきです。矛盾解決は常に既存ドキュメントの修正によって行います。

### 整合性修正の完了基準

**矛盾点の修正は、以下の条件がすべて満たされた場合にのみ「修正済み」とみなされます**：

1. すべての検出された矛盾点が解決されている
2. 修正済みのドキュメント全体がアーティファクトとして出力されている
3. 修正後のドキュメントが再検証され、新たな矛盾が発生していないことが確認されている
4. documents-consistency-analysis.md が更新され、解決された矛盾点が記録されている

部分的な修正や、全体のドキュメントをアーティファクトとして出力していない場合は、「修正中」として扱われ、まだ完了とはみなされません。

### 1. 矛盾箇所の特定と優先順位付け

1. **影響度評価**:
   - 高: プロジェクトの核心機能や基本設計に関わる矛盾
   - 中: 実装詳細や技術選択に関わる矛盾
   - 低: 形式や表現の一貫性に関わる矛盾

2. **優先順位付け**:
   - 高影響度の矛盾を最優先で解決
   - ベースドキュメント（specification.md）と他のドキュメント間の矛盾を優先
   - 現在または次の開発フェーズに影響する矛盾を優先

3. **更新対象ドキュメントの選定**:
   - 複数のドキュメント間で矛盾がある場合、以下の優先順位で更新対象を決定：
     1. specification.md（内容に問題がある場合のみ）
     2. 実装詳細を記述するドキュメント（矛盾内容がより詳細な実装に関わる場合）
     3. より最近に作成/更新されたドキュメント
     4. より詳細な情報を含むドキュメント

### 2. ドキュメント更新パターン

以下のパターンに沿って既存ドキュメントを更新します：

1. **追加による更新**:
   - 既存ドキュメントに不足している情報を追加
   - 例: API仕様書にセキュリティ関連セクションを追加
   - ドキュメント構造を維持しながら、適切な位置に情報を挿入

   ```diff
   + ## 7. セキュリティ考慮事項
   + 
   + ### 7.1 認証と認可
   + ...
   ```

2. **修正による更新**:
   - 既存ドキュメント内の不正確または矛盾する情報を修正
   - 例: ユーザーインターフェースの設計でタブ数の不一致を修正

   ```diff
   - 3つのタブ（ホーム、検索、プロフィール）で構成されたナビゲーション
   + 5つのタブ（タイムライン、マップ、ブルワリー検索、イベント、プロフィール）で構成されたナビゲーション
   ```

3. **統合による更新**:
   - 複数のドキュメントに分散した情報を一箇所に統合
   - 例: セキュリティ関連の記述を一つのセクションにまとめる

   ```diff
   ## 5. セキュリティ対策
   
   + 以下のセキュリティ対策を実装します：
   + 
   + ### 5.1 認証セキュリティ
   + - JWTトークン有効期限: アクセストークン(15分)、リフレッシュトークン(7日)
   + - トークンローテーション: リフレッシュトークン使用時に新規発行
   + - JWTペイロード最小化: 必要最小限の情報のみ格納
   ...
   ```

4. **詳細化による更新**:
   - 既存の情報をより詳細に展開
   - 例: モバイル開発戦略の詳細化

   ```diff
   ## 4. モバイル開発戦略
   
   - モバイルアプリはフェーズ4で開発します。
   + モバイル開発は以下の戦略で進めます：
   + 
   + 1. **設計アプローチ**: すべてのフェーズでモバイルファースト設計を採用
   + 2. **実装戦略**: 
   +    - フェーズ0-3: レスポンシブWebアプリでモバイル体験を提供
   +    - フェーズ4: React Nativeによるネイティブアプリ開発
   +    - フェーズ5: モバイル固有機能とAI統合
   + 3. **技術選択**: React Native + Expoによるクロスプラットフォーム開発
   ...
   ```

### 3. 更新時の留意事項

1. **更新履歴の追加**:
   - 必ずドキュメントの更新履歴セクションに変更内容を記録
   - 日付、更新者、変更内容の簡潔な説明を含める

   ```diff
   # 更新履歴
   - 2025-04-15 Koki Riho 初版作成
   - 2025-04-18 Koki Riho コンセプト再定義と実装計画を追加
   + - 2025-04-21 Koki Riho セキュリティセクションを追加、モバイル開発戦略を詳細化
   ```

2. **ドキュメントの一貫性維持**:
   - 用語の統一性を維持（新たな用語を導入しない）
   - フォーマットと構造の一貫性を保持
   - ドキュメント間の相互参照を適切に更新

3. **明示的な変更マーキング** (提案用ドラフトの場合):
   - 変更箇所を明示的にマーキング (例: ハイライト、コメント、変更履歴)
   - 大規模な変更の場合は変更概要を提供

### 4. 更新後の確認プロセス

1. **修正済みドキュメント全体のアーティファクト出力**:
   - 修正完了後、ドキュメント全体をアーティファクトとして出力
   - アーティファクトには修正前後の比較ではなく、完全な修正済みドキュメントを含める
   - アーティファクトには適切なタイトルと説明を付与

2. **整合性の再確認**:
   - 更新によって新たな矛盾が生じていないか確認
   - 関連ドキュメントとの整合性を再確認
   - すべての矛盾点が解決されていることを確認

3. **documents-consistency-analysis.mdの更新**:
   - 解決した矛盾を「解決済みの矛盾点」セクションに移動
   - 解決方法と実施日を記録
   - 新たに発見された矛盾点があれば追加

4. **関連ドキュメントの確認**:
   - 更新内容が他のドキュメントに影響するか確認
   - 必要に応じて関連ドキュメントも更新

### 5. 実践的なワークフロー例

**例: セキュリティ関連の矛盾解決**

1. **矛盾の特定**:
   - implementation-plan.mdには詳細なセキュリティ対策が記載
   - api-document.mdにはセキュリティに関する記述が不足

2. **解決方針の決定**:
   - api-document.mdを直接更新してセキュリティセクションを追加
   - 追加内容はimplementation-plan.mdの記述と整合性を確保

3. **更新内容の作成**:
   - api-document.mdにセキュリティ概要、認証・認可、入力検証、CSRFトークン対策のセクションを追加
   - 具体的な実装詳細はimplementation-plan.mdから参照

4. **更新の実施**:
   - api-document.mdを更新
   - 更新履歴に変更内容を記録

5. **整合性の再確認**:
   - 修正したapi-document.mdに新たな矛盾が生じていないか確認
   - implementation-plan.mdとの整合性を再確認

6. **完全な修正済みドキュメントのアーティファクト出力**:
   - 修正されたapi-document.md全体をアーティファクトとして出力
   - アーティファクトのタイトルに「修正版 - API仕様書」などの明確な表記を含める

7. **整合性分析レポートの更新**:
   - documents-consistency-analysis.mdでセキュリティ関連の矛盾を「解決済み」に移動
   - 解決方法の記録（「api-document.mdにセキュリティセクションを追加」）

これらのステップに従うことで、プロジェクト全体のドキュメント整合性を維持しながら、既存ドキュメントを効率的に更新することができます。

成果物の内容を送付いただければ、できるだけ早く整合性確認を行い、必要に応じて既存ドキュメントの更新案を提供します。確認によって発見された問題点はプロジェクトの品質向上のために活用します。よろしくお願いいたします。
