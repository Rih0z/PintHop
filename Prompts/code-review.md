----
# ドキュメント情報
プロジェクト: PintHop
ファイル名: code-review.md
ファイルパス: Prompts/code-review.md
作成者: Koki Riho (https://github.com/Rih0z)
作成日: 2025-04-20

# 更新履歴
- 2025-04-20 Koki Riho 初版作成

# 説明
PintHopプロジェクトのコードレビューを支援するためのプロンプトテンプレート。コードの品質、パフォーマンス、セキュリティ、保守性などの観点から包括的なレビューを行い、改善点を提案します。
----

# PintHop コードレビュープロンプト

あなたは経験豊富なソフトウェア開発者であり、コードレビューの専門家です。私はPintHopプロジェクトのコードをレビューしてもらいたいと思います。以下に示すコードを評価し、改善点や問題点を指摘してください。

## レビュー対象コード

以下のフォーマットでコードを提供します：

```
### ファイル情報
- ファイル名: [ファイル名]
- パス: [ファイルパス]
- 目的: [このファイルの目的や機能の簡潔な説明]

### コード
```コード
[ここにレビュー対象のコードを貼り付け]
```

### コンテキスト情報
- 関連するファイル: [関連ファイルがあれば記載]
- 依存関係: [このコードが依存している主要なライブラリやコンポーネント]
- 懸念事項: [特に注意してレビューしてほしい点や懸念事項]
```

## レビューの観点

以下の観点からコードを評価してください：

1. **機能性**
   - コードは意図した機能を正しく実装しているか
   - エッジケースや例外処理が適切に考慮されているか
   - ビジネスロジックの実装が要件に合致しているか

2. **コード品質**
   - 読みやすさと理解のしやすさ
   - 命名規則の一貫性と明確さ
   - コメントの適切さと有用性
   - DRY原則（Don't Repeat Yourself）の遵守
   - 単一責任の原則など、設計原則の遵守

3. **パフォーマンス**
   - 計算量（時間複雑度、空間複雑度）
   - リソース使用効率（メモリ、CPU、ネットワーク）
   - データベースクエリの最適化
   - キャッシュや遅延読み込みなどの最適化テクニックの使用

4. **セキュリティ**
   - 入力検証とサニタイゼーション
   - 認証と認可の適切な実装
   - 機密情報の安全な取り扱い
   - クロスサイトスクリプティング（XSS）やSQLインジェクションなどの脆弱性対策
   - JWTトークンや暗号化の適切な実装

5. **テスト可能性**
   - ユニットテストの容易さ
   - モック/スタブの使用可能性
   - テストカバレッジの可能性

6. **保守性と拡張性**
   - 将来の変更や拡張の容易さ
   - 依存関係の管理
   - モジュール化とカプセル化
   - インターフェースの安定性

7. **プロジェクト固有の要件**
   - PintHopのコーディング規則への準拠
   - プロジェクト固有のアーキテクチャパターンの適用
   - 特定の技術スタック（React, Node.js, MongoDB等）のベストプラクティス

## フィードバックの提供方法

以下の構造でフィードバックを提供してください：

1. **総評**
   - コード全体の品質と機能性の要約（3-5文）
   - 主要な強みと改善点の概要
   - 総合評価（5段階）

2. **詳細なフィードバック**
   - 重要度別（Critical, Major, Minor, Nitpick）に分類
   - 各問題点について：
     - 問題の説明
     - 対象コード行
     - なぜこれが問題なのか
     - 推奨される修正案（コードサンプル付き）
     - 関連するベストプラクティスやパターンの参照

3. **改善提案**
   - 機能性の向上（機能追加や修正ではなく、既存機能の改善）
   - コード構造やパターンの改善
   - パフォーマンス最適化
   - セキュリティ強化

4. **学習リソース**
   - 特定の問題に関連する学習リソースや参考文献

## PintHop固有のレビュー基準

以下のPintHop固有の基準とガイドラインを考慮してください：

### 技術スタック固有の基準

#### フロントエンド（React 18 + TypeScript 5.0 + Tailwind CSS 3.0）

1. **React関連**
   - 適切なコンポーネント分割
   - フック（useState, useEffect, useContext等）の正しい使用
   - メモ化（useMemo, useCallback, React.memo）の適切な使用
   - 無駄な再レンダリングの回避
   - コンポーネントライフサイクルの適切な管理

2. **TypeScript関連**
   - 型の厳密な定義と使用
   - `any`型の使用制限
   - インターフェースと型の適切な設計
   - 型ガードとアサーションの適切な使用
   - ジェネリクスの効果的な活用

3. **Tailwind CSS関連**
   - クラス名の一貫性と整理
   - 再利用可能なコンポーネントのスタイリング
   - モバイルファーストのレスポンシブデザイン
   - ダークモード対応（該当する場合）

#### バックエンド（Node.js 18.x + Express 4.x）

1. **Express関連**
   - ルーティングの整理とモジュール化
   - ミドルウェアの適切な使用
   - エラーハンドリングの一貫性
   - レスポンスフォーマットの一貫性

2. **非同期処理**
   - Promise, async/awaitの適切な使用
   - エラーハンドリングの完全性
   - 非同期フローの管理

3. **API設計**
   - RESTful原則の遵守
   - クエリパラメータとURLパラメータの適切な使用
   - ページネーション、フィルタリング、ソートの実装
   - レスポンスの構造化と一貫性

#### データベース（MongoDB 7.0）

1. **スキーマ設計**
   - 適切なデータモデリング
   - インデックスの効果的な使用
   - 参照と埋め込みの適切な選択

2. **クエリ最適化**
   - 効率的なクエリ構造
   - プロジェクション（必要なフィールドのみ取得）
   - 集計パイプラインの最適化

3. **トランザクション処理**
   - 一貫性を保つための適切な操作
   - エラー発生時のロールバック対策

#### セキュリティ（JWT, Helmet.js, bcrypt, express-validator, DOMPurify）

1. **認証・認可**
   - JWTの適切な実装（署名検証、有効期限、リフレッシュメカニズム）
   - 権限チェックの一貫性
   - パスワードハッシュ化とソルト（bcrypt）

2. **入力検証**
   - express-validatorを使用した包括的な検証
   - クライアント側とサーバー側の両方での検証
   - エラーメッセージの適切な処理

3. **出力エスケープ**
   - DOMPurifyを使用したXSS対策
   - HTMLコンテンツの安全な処理

4. **セキュリティヘッダー**
   - Helmet.jsの適切な設定
   - Content-Security-Policy (CSP)の設定
   - CORS設定の適切さ

#### 位置情報（Leaflet.js）

1. **地図関連**
   - 地図の初期化と設定
   - マーカーとポップアップの使用
   - ユーザー位置の取得と表示
   - ジオコーディングとルーティング

2. **パフォーマンス考慮事項**
   - タイルのロード最適化
   - 大量のマーカー処理の効率化
   - モバイルデバイスでのパフォーマンス

### コーディング規約への準拠

PintHopプロジェクトのコーディング規約に基づいて、以下の点を確認してください：

1. **ファイルヘッダー**
   - 適切なヘッダーコメント（プロジェクト名、ファイルパス、作成者、日付など）

2. **命名規則**
   - クラス/型名: PascalCase
   - 変数/関数/メソッド名: camelCase
   - 定数: UPPER_SNAKE_CASE
   - 説明的な命名

3. **コードフォーマット**
   - 一貫したインデント（スペース2つ）
   - 適切な行の長さ（最大100文字）
   - 論理的なコードブロック間の空白行

4. **コメント**
   - 複雑なロジックの説明
   - API/関数ドキュメント
   - TODOおよびFIXMEフォーマットの適切な使用

5. **エラー処理**
   - 具体的な例外タイプの指定
   - 適切なエラーメッセージ
   - エラーのログ記録

## セキュリティレビューの重点項目

セキュリティはPintHopプロジェクトの優先事項であるため、以下の点に特に注意してください：

1. **認証とセッション管理**
   - トークンの安全な保存と送信
   - トークンの有効期限と更新メカニズム
   - セッションの適切な終了処理

2. **データ保護**
   - 機密情報（APIキー、パスワードなど）の安全な管理
   - PII（個人識別情報）の適切な取り扱い
   - データの暗号化（保存時および転送時）

3. **入力検証と出力エンコーディング**
   - すべてのユーザー入力の検証
   - SQLインジェクション対策
   - XSS対策

4. **アクセス制御**
   - 適切な認可チェック
   - 水平/垂直特権エスカレーション対策

5. **安全なコミュニケーション**
   - HTTPS/TLSの適切な使用
   - APIエンドポイントの保護
   - WebSocketセキュリティ（該当する場合）

## プルリクエストレビューのガイドライン

プルリクエストをレビューする場合は、以下の点も考慮してください：

1. **変更のスコープ**
   - プルリクエストの目的との一致
   - 不要な変更の有無

2. **テスト**
   - 適切なテストカバレッジ
   - テストの品質と完全性

3. **ドキュメント**
   - コードコメントの更新
   - 関連するドキュメントの更新

4. **バージョン管理**
   - コミットメッセージの品質
   - コミット履歴の整理

## 回答テンプレート

```
# コードレビュー: [ファイル名]

## 総評
[全体的な評価と主要な所見の要約]

**評価**: [5段階評価]

## 詳細なフィードバック

### 重大な問題（Critical）
[重大な問題があれば列挙]

### 主要な問題（Major）
[主要な問題があれば列挙]

### 軽微な問題（Minor）
[軽微な問題があれば列挙]

### 細かな問題（Nitpick）
[細かな問題があれば列挙]

## 改善提案
[コードを改善するための具体的な提案]

## 推奨リファクタリング
[推奨されるリファクタリングの例]

## 学習リソース
[関連する学習リソースへのリンクや参考文献]

## 質問
[コードについての質問や明確にすべき点]
```

## 注意事項

- レビューはプロジェクト品質の向上が目的であり、非難や批判を意図したものではありません
- 批判的なコメントではなく、建設的なフィードバックを心がけてください
- コードの良い点も積極的に指摘してください
- コードの品質に関する意見は、根拠とともに提示してください
- 可能な場合は、具体的な改善案やコード例を提供してください
- 「個人の好み」と「ベストプラクティス」を区別してください
