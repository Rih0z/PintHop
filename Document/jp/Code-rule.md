# 汎用的なコード規則 (Universal Coding Standards)

## 1. ファイルヘッダー規則

すべてのソースファイルの冒頭に以下の情報を含めること:

```
/**
 * プロジェクト: [プロジェクト名]
 * ファイルパス: [プロジェクトルートからの相対パス]
 * 
 * 作成者: [名前]
 * 作成日: [YYYY-MM-DD HH:mm:ss]
 * 
 * 更新履歴:
 * - [YYYY-MM-DD HH:mm:ss] [名前] [更新内容の簡潔な説明]
 * - [YYYY-MM-DD HH:mm:ss] [名前] [更新内容の簡潔な説明]
 *
 * 説明:
 * [このファイルの目的と機能の簡潔な説明]
 */
```

## 2. 命名規則

- **クラス/型名**: PascalCase (例: `UserProfile`, `DataProcessor`)
- **変数/関数/メソッド名**: camelCase (例: `getUserData()`, `isValid`)
- **定数**: UPPER_SNAKE_CASE (例: `MAX_RETRY_COUNT`, `API_BASE_URL`)
- **ファイル名**: 内容を表す意味のある名前。コンポーネントはPascalCase、それ以外はkebab-caseまたはsnake_case
- **命名は説明的に**: 短い略語より具体的な名前を使用 (`getData()`より`fetchUserProfiles()`)
- **ブール変数**: `is`, `has`, `can`などの接頭辞を使用 (例: `isActive`, `hasPermission`)

## 3. コードフォーマット

- **インデント**: スペース4つまたは2つで統一（言語により異なる場合あり）
- **行の長さ**: 最大80-120文字（プロジェクトで統一）
- **ブロック**: 開始ブレースは同じ行、終了ブレースは新しい行に配置
- **空白行**: 論理的なコードブロック間に挿入して可読性を向上
- **関数の長さ**: 一つの関数は最大30-50行程度に制限
- **ファイルの長さ**: 一つのファイルは500-1000行程度に制限

## 4. コメント規則

- **コードを説明するコメント**: なぜその実装をしたのか、複雑なロジックの説明に使用
- **TODO形式**: `// TODO(名前): 実装すべき内容 (チケット番号)`
- **FIXME形式**: `// FIXME(名前): 修正すべき問題 (チケット番号)`
- **API/関数ドキュメント**: すべての公開API/関数の前に入力、出力、例外を文書化
- **冗長なコメントを避ける**: コード自体が説明的で明確な場合は不要

## 5. エラー処理

- **例外のキャッチ**: 具体的な例外タイプを指定してキャッチ（`catch(Exception)`は避ける）
- **エラーメッセージ**: 具体的で行動可能なメッセージを提供
- **リカバリーメカニズム**: エラー発生時のフォールバック策を実装
- **エラーログ**: エラー発生箇所、スタックトレース、関連パラメータを記録
- **ユーザー向けエラー**: 技術的詳細を省き、対処方法を提示

## 6. セキュリティガイドライン

- **入力バリデーション**: すべてのユーザー入力を検証
- **認証・認可**: 適切な認証メカニズムと最小権限の原則を適用
- **機密情報**: シークレットキー等はハードコードせず環境変数または安全なストレージを使用
- **SQL/NoSQL注入対策**: パラメータ化クエリを使用
- **クロスサイトスクリプティング(XSS)対策**: 出力エスケープを徹底
- **CSRF対策**: トークンベースの保護を実装

## 7. テスト規則

- **ユニットテスト**: すべての公開関数/メソッドに対して作成
- **テストカバレッジ**: コードカバレッジ80%以上を目標
- **テスト命名**: `test_[テスト対象の機能]_[テスト条件]_[期待される結果]`
- **テストの独立性**: 各テストは他のテストに依存しないこと
- **モック/スタブ**: 外部依存は適切にモック化
- **境界値テスト**: エッジケースを含む入力範囲を網羅

## 8. コード構造と組織

- **関心の分離**: 異なる機能は異なるモジュール/クラスに分離
- **単一責任の原則**: 各クラス/関数は単一の責任のみを持つ
- **依存性注入**: ハードコードされた依存関係を避け、外部から注入
- **インターフェース**: 実装より抽象インターフェースに依存
- **ファイル/フォルダ構造**: 論理的な階層構造を維持（機能/レイヤー別など）

## 9. コードレビュー基準

- **コミットサイズ**: 1プルリクエストあたり300-500行以下が推奨
- **レビューポイント**: セキュリティ、パフォーマンス、可読性、テスト、仕様適合性
- **自己レビュー**: プルリクエスト提出前に自己レビューを実施
- **指摘への対応**: すべてのレビューコメントに対応または議論

## 10. バージョン管理プラクティス

- **コミットメッセージ**: `[type]: [簡潔な説明] (関連チケット番号)`
  - typeの例: feat, fix, docs, style, refactor, test, chore
- **ブランチ戦略**: GitFlowまたはGitHub Flowなどの標準的な戦略を採用
- **リリースタグ**: セマンティックバージョニング(major.minor.patch)に従う

## 11. 依存関係管理

- **バージョン固定**: すべての依存関係のバージョンを明示的に固定
- **定期的な更新**: セキュリティ更新とパッチを定期的に適用
- **最小限の依存関係**: 必要最小限の外部ライブラリのみを使用

## 12. AI実装固有の規則

- **AI呼び出し分離**: AIモデル呼び出しは専用サービス層に分離
- **プロンプト管理**: プロンプトテンプレートは定数または設定ファイルで管理
- **応答検証**: AIからの応答は必ず検証し、予期せぬ出力に対処
- **フォールバック**: AI機能が失敗した場合の代替パスを実装
- **ユーザーフィードバック**: AI応答の品質向上のためのフィードバックメカニズムを実装

## 13. パフォーマンス最適化

- **早期最適化を避ける**: プロファイリングに基づいて最適化を実施
- **リソース管理**: 接続、ファイルハンドル等のリソースは適切に解放
- **遅延読み込み**: 必要になるまでリソースを読み込まない
- **キャッシング**: 頻繁にアクセスされるデータはキャッシュを検討

## 14. 国際化と地域化

- **ハードコードされた文字列を避ける**: 表示テキストは翻訳ファイルに分離
- **日付/時刻/数値のフォーマット**: 地域設定に依存しないよう注意
- **文化的配慮**: 文化固有の参照やメタファーを避ける

## 15. アクセシビリティ

- **セマンティックHTML**: 適切なHTML要素とARIA属性を使用（Webアプリ）
- **キーボードナビゲーション**: すべての機能がキーボードでアクセス可能
- **スクリーンリーダー対応**: 代替テキスト、適切なラベルを提供
- **コントラスト**: 十分な色コントラストを確保

## 16. ドキュメンテーション

- **コード内ドキュメント**: すべての公開API/クラスに説明を付与
- **README**: 各リポジトリには適切なREADMEを含め、設定・実行方法を説明
- **アーキテクチャ図**: 複雑なシステムには構成図を提供
- **更新の同期**: コード変更時にドキュメントも更新
