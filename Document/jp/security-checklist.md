----
# ドキュメント情報
プロジェクト: PintHop
ファイル名: security-checklist.md
ファイルパス: Document/jp/security-checklist.md
作成者: Koki Riho (https://github.com/Rih0z)
作成日: 2025-04-20

# 更新履歴
- 2025-04-20 Koki Riho 初版作成

# 説明
PintHopアプリケーションの開発、デプロイ、運用の各段階で実施すべきセキュリティチェック項目をまとめたリスト。定期的なセキュリティレビューの実施と、セキュリティ基準の維持を目的としています。
----

# PintHop セキュリティチェックリスト

## 1. 開発段階のセキュリティチェック

### 1.1 認証・認可システム
- [ ] JWTトークンの有効期限が適切に設定されている（アクセストークン：15分以内、リフレッシュトークン：7日以内）
- [ ] JWTペイロードには最小限の情報のみが含まれている
- [ ] パスワードはbcryptで適切に暗号化されている（コスト係数14以上）
- [ ] パスワード強度ポリシーが実装されている（最低8文字、英数字記号混在）
- [ ] アカウントロックアウトメカニズムが実装されている（5回連続失敗で10分間ロック）
- [ ] ユーザー権限の検証が各保護されたルートで実施されている
- [ ] セッション管理が安全に実装されている

### 1.2 入力検証とデータ保護
- [ ] すべてのユーザー入力に対してサーバーサイド検証が実装されている
- [ ] Express-validatorによる各APIエンドポイントの入力検証が行われている
- [ ] MongoDBインジェクション対策が実装されている（型チェック実施）
- [ ] NoSQLインジェクション対策が実装されている（$whereオペレータ制限）
- [ ] XSS対策としてDOMPurifyによる出力サニタイゼーションが行われている
- [ ] ContentSecurityPolicy（CSP）が適切に設定されている
- [ ] 機密情報（APIキー、パスワードなど）がソースコードにハードコードされていない

### 1.3 APIセキュリティ
- [ ] Express-rate-limitによるレート制限が実装されている
  - [ ] 認証エンドポイント: 10req/5min
  - [ ] 一般エンドポイント: 100req/min
- [ ] CORS設定が適切に構成されている（許可オリジンの明示的設定）
- [ ] Helmet.jsによるセキュリティヘッダーが設定されている
- [ ] APIエラーメッセージが詳細な技術情報を漏洩していない
- [ ] APIドキュメントが機密情報を含んでいない

### 1.4 位置情報とプライバシー
- [ ] 位置情報へのアクセス前にユーザーの明示的な同意を取得している
- [ ] プライバシー設定のデフォルトが制限的になっている（友達のみ表示など）
- [ ] 位置履歴の保存期間が適切に設定されている（30日など）
- [ ] ユーザーが自分の位置データを削除できる機能がある
- [ ] プレゼンス情報の共有範囲を細かく設定できる

### 1.5 依存関係の管理
- [ ] 使用しているライブラリの脆弱性がnpm auditで確認されている
- [ ] 使用するライブラリのバージョンが固定されている
- [ ] サードパーティライブラリの最新セキュリティパッチが適用されている
- [ ] 未使用の依存関係がプロジェクトから削除されている

### 1.6 コード品質とセキュリティレビュー
- [ ] セキュリティを考慮したコードレビュープロセスが確立されている
- [ ] 静的コード解析ツールが導入されている
- [ ] コードにセキュリティの脆弱性が含まれていないか確認されている
- [ ] セキュアコーディングガイドラインに準拠している
- [ ] デバッグコードやコメントアウトされたコードが削除されている

## 2. デプロイ前セキュリティチェック

### 2.1 環境設定
- [ ] すべての機密情報が環境変数または安全なシークレット管理サービスで管理されている
- [ ] 本番環境の環境変数が適切に保護されている
- [ ] 異なる環境（開発、テスト、本番）の設定が適切に分離されている
- [ ] デバッグモードが本番環境で無効になっている
- [ ] エラーメッセージが本番環境で一般ユーザーに表示されないようになっている

### 2.2 インフラストラクチャセキュリティ
- [ ] SSLが正しく設定されており、HTTPS接続が強制されている
- [ ] SSL証明書が有効で、安全な暗号スイートが使用されている
- [ ] Nginxのセキュリティ設定が完了している
  - [ ] サーバー情報の非表示 (`server_tokens off`)
  - [ ] セキュリティヘッダーの設定
  - [ ] 安全なSSLプロトコルの設定
- [ ] ファイアウォール設定が適切に構成されている（不要なポートが閉じられている）
- [ ] SSH接続のセキュリティが強化されている（パスワード認証無効化、鍵認証のみ）

### 2.3 データベースセキュリティ
- [ ] MongoDB接続がSSL/TLSで暗号化されている
- [ ] データベースユーザーに最小権限が付与されている
- [ ] 本番データベースへのアクセスが制限されている
- [ ] バックアップが暗号化されている
- [ ] センシティブデータが適切に保護されている

### 2.4 認証と認可
- [ ] すべての保護されたエンドポイントに認証チェックが実装されている
- [ ] ロールベースのアクセス制御が正しく機能している
- [ ] API認証トークンの有効期限と更新プロセスがテストされている
- [ ] ログアウト機能が正しく機能し、トークンが無効化されている

### 2.5 フロントエンドセキュリティ
- [ ] フロントエンドでのセンシティブデータ（トークン等）の保存方法が安全
- [ ] LocalStorageではなくHttpOnly Cookieを使用してセンシティブデータを保存
- [ ] React内でのXSS脆弱性がチェックされている
- [ ] フォーム入力のバリデーションが実装されている

### 2.6 セキュリティテスト
- [ ] 脆弱性スキャンが実施され、発見された問題が修正されている
- [ ] ペネトレーションテストが実施され、発見された問題が修正されている
- [ ] 認証バイパスのテストが実施されている
- [ ] クロスサイトリクエストフォージェリ（CSRF）対策がテストされている
- [ ] APIのセキュリティテストが実施されている

## 3. 定期的な運用セキュリティチェック

### 3.1 日次運用確認（5分）
- [ ] エラーアラートメールの確認
- [ ] アップタイム監視ダッシュボードの確認
- [ ] バックアップ実行ログの確認
- [ ] セキュリティアラート（不正アクセス試行など）の確認

### 3.2 週次運用確認（15分）
- [ ] リソース使用率レポートの確認
- [ ] セキュリティアップデート通知の確認
- [ ] ログファイルの異常パターン確認
- [ ] バックアップファイルの完全性チェック
- [ ] ユーザー認証関連のエラーパターンの分析
- [ ] 不審なIPアドレスからのアクセス確認

### 3.3 月次運用確認（30分）
- [ ] 全システムのアップデート状況確認
- [ ] SSL証明書の有効期限確認
- [ ] 不要なユーザーアカウント・データの確認と削除
- [ ] 監視スクリプトの動作確認
- [ ] MongoDB Atlas課金状況の確認
- [ ] セキュリティパッチの適用状況確認
- [ ] バックアップ手順の有効性確認

### 3.4 四半期運用確認（2時間）
- [ ] セキュリティポリシーの見直し
- [ ] アクセスログの詳細分析（不審なパターンの検出）
- [ ] バックアップからの復元テスト
- [ ] AWS S3/Cloudfront設定の確認
- [ ] Netlify設定の確認
- [ ] すべての依存関係の脆弱性スキャン
- [ ] セキュリティ対策の効果測定
- [ ] セキュリティインシデント対応計画のレビュー

## 4. サードパーティ製品の安全性検証

### 4.1 導入前の評価
- [ ] サードパーティベンダーのセキュリティポリシーの確認
- [ ] プライバシーポリシーの確認（データの収集・使用・共有方針）
- [ ] セキュリティ認証（SOC 2、ISO 27001など）の確認
- [ ] 既知の脆弱性や過去のセキュリティインシデントの調査
- [ ] オープンソースの場合、コミュニティの活発さとメンテナンス状況の確認

### 4.2 統合時の検証
- [ ] 最小権限の原則に基づいたアクセス権限の付与
- [ ] APIキーやシークレットの安全な管理
- [ ] データの暗号化（保存時および転送時）の確認
- [ ] 認証メカニズムの安全性確認
- [ ] ネットワークトラフィックの監視と制限

### 4.3 継続的なモニタリング
- [ ] セキュリティアップデートとパッチの適用状況確認
- [ ] 使用状況とアクセスパターンの定期的な監査
- [ ] サービスレベルの異常（パフォーマンス低下など）の監視
- [ ] データ共有と統合ポイントの定期的なレビュー
- [ ] ライセンス条項とコンプライアンスの確認

### 4.4 主要サードパーティサービス固有のチェック

#### 4.4.1 MongoDB Atlas
- [ ] ネットワークアクセス制限が適切に設定されている
- [ ] データベースユーザーに最小権限が付与されている
- [ ] バックアップが有効化され、定期的に実行されている
- [ ] 監査ログが有効化されている
- [ ] IP許可リストが定期的に更新されている

#### 4.4.2 Netlify
- [ ] デプロイ設定のセキュリティレビュー
- [ ] 環境変数の安全な管理
- [ ] アクセス制御の設定確認
- [ ] 継続的インテグレーション/デプロイのセキュリティ
- [ ] Netlifyフォーム処理のセキュリティ設定

#### 4.4.3 Mapbox（地図サービス）
- [ ] APIキーの制限設定（リファラー制限など）
- [ ] 使用量モニタリングの設定
- [ ] クライアントサイドでの安全な統合
- [ ] 位置データの適切な処理と保護

## 5. 対応チェックリスト

### 5.1 セキュリティインシデント発生時
- [ ] インシデントの影響範囲を特定
- [ ] 即時対応策を実施（アカウントロック、システム隔離など）
- [ ] インシデント対応計画に従って関係者に通知
- [ ] ログと証拠の収集・保存
- [ ] 根本原因の分析と恒久的な対策の実施
- [ ] インシデント報告書の作成

### 5.2 システム変更時
- [ ] 変更管理プロセスに従っている
- [ ] 変更前のセキュリティリスク評価が実施されている
- [ ] 変更後のセキュリティテストが実施されている
- [ ] ロールバック計画が準備されている
- [ ] 変更のドキュメント化が完了している

## 付録: セキュリティチェックリスト使用ガイドライン

### 使用方法
1. 各開発フェーズの開始時にこのチェックリストを参照
2. 該当するセクションのチェック項目を確認し、対応
3. デプロイ前に「デプロイ前セキュリティチェック」セクションを完了
4. 定期的な運用確認は指定された頻度で実施
5. 新しいサードパーティサービス導入時は「サードパーティ製品の安全性検証」セクションを使用

### チェックリストの更新
- セキュリティ要件や脅威の変化に応じて定期的に更新
- 新しい技術やサービスを導入する際に関連項目を追加
- セキュリティインシデントから学んだ教訓を反映
- 業界のベストプラクティスや標準の変更を反映

### 関連ドキュメント
- [セキュリティポリシー](security-policy.md)
- [インシデント対応計画](incident-response.md)
- [デプロイメント手順書](deployment-document.md)
